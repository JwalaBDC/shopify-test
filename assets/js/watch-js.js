const fs=require("fs"),path=require("path"),{spawn:spawn}=require("child_process"),SRC_DIR=path.resolve(__dirname);let isBuilding=!1,queued=!1,debounceId=null;function runBuild(){if(isBuilding)return void(queued=!0);isBuilding=!0;const e=(process.platform,"npm run build:js");spawn(e,[],{stdio:"inherit",shell:!0}).on("close",e=>{isBuilding=!1,0!==e&&console.error("JS watch build failed with exit code",e),queued&&(queued=!1,runBuild())})}function scheduleBuild(){debounceId&&clearTimeout(debounceId),debounceId=setTimeout(()=>{runBuild()},150)}function watch(){console.log("Watching JS:",path.relative(process.cwd(),SRC_DIR)),runBuild(),fs.watch(SRC_DIR,{recursive:!0},(e,i)=>{if(!i)return;const u=i.toString();u.endsWith(".js")&&(u.endsWith(".bkp.js")||scheduleBuild())})}watch();