import{motionObserverInstance}from"../motion/observers/MotionObserver.js";class RecentlyViewed{constructor(t){this.maxItems=13,this.recentSlider=t,this.baseUrl=window.location.origin,this.init()}init(){this.recentSlider.setAttribute("hidden",!0);const t=window.location.pathname,e=t.indexOf("/p/");let i=t.substring(e);if(-1!==e){const t=this.getProductData(i);t&&setTimeout(()=>{this.updateStorage(t)},500)}else this.showRecentlyViewedProducts()}getProductData(t){let e,i=document.querySelectorAll(".ui-product-gallery__slider-item img");for(let t=0;t<i.length;t++)if(!i[t].hasAttribute("is-featured-hero-image")){e=i[t];break}e||(e=i[0]);let r=document.querySelector("#overview").dataset.productImageType,a="";return e&&(a=e.getAttribute("data-common-src")||e.getAttribute("data-desktop-src")||e.getAttribute("src")||"https://bdcdev-gnb-media.s3.ap-south-1.amazonaws.com/img1_f6292b5b19.png"),"assets/common/images/empty.webp"==a&&(a="https://bdcdev-gnb-media.s3.ap-south-1.amazonaws.com/img1_f6292b5b19.png"),{id:t,name:document.querySelector("#overview").dataset.productTitle,url:window.location.href,slug:t,image:a,listingImageType:r}}updateStorage(t){let e=JSON.parse(localStorage.getItem("recentlyViewedProducts")||"[]");e=e.filter(e=>e.slug!==t.slug),e.unshift(t),e.length>this.maxItems&&e.pop(),localStorage.setItem("recentlyViewedProducts",JSON.stringify(e)),console.log("recentlyViewedProducts",e),this.setData(e,t.name)}showRecentlyViewedProducts(){let t=JSON.parse(localStorage.getItem("recentlyViewedProducts")||"[]");this.setData(t,null)}setData(t,e){if(!t||0===t.length)return this.recentSlider.setAttribute("hidden","true"),void this.recentSlider.setAttribute("aria-hidden","true");let i="",r=0;if(t.forEach((t,a)=>{if(t.name!==e){r++;let e=""===t.image?"assets/common/images/empty.webp":t.image,s=""===t.image?"":"is-loaded";i+=`\n\t\t\t\t<li slider-card class="ui-product-card__list-item">\n\t\t\t\t\t<div class="ui-product-card --recently-viewed" data-stagger-motion-index="${a}" data-stagger-motion-type="sm">\n\t\t\t\t\t\t<card-link-interface class="ui-product-card__content">\n\t\t\t\t\t\t\t<div class="ui-product-card__image-wrapper ${"Cover"==t.listingImageType?"ui-product-card__image--cover":""}">\n\t\t\t\t\t\t\t\t<img alt="" src="${e}" data-image data-common-src="${e}" width="192" height="144" class="ui-product-card__image ${s}" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-product-card__body">\n\t\t\t\t\t\t\t\t<h3 class="ui-product-card__title"><a card-link href="${t.url}">${t.name}</a></h3>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</card-link-interface>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t`}}),this.recentSlider.querySelector(".ui-product-card__list").innerHTML=i,this.recentSlider.querySelector(".ui-product-card__list").dataset.motionObserver="stagger",motionObserverInstance.addToObservedElements(this.recentSlider.querySelector(".ui-product-card__list")),r>0){this.recentSlider.querySelector("slider-interface").reinitialize(),this.recentSlider.removeAttribute("hidden"),this.recentSlider.setAttribute("aria-hidden","false")}}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[recently-viewed]").forEach(t=>new RecentlyViewed(t))});