class TabInterface extends HTMLElement{constructor(){super(),this.tabList=Array.from(this.querySelectorAll('[role="tablist"]')).filter(t=>t.closest("tab-interface")===this),this.tabList=this.tabList[0],this.tabs=Array.from(this.querySelectorAll('[role="tab"]')).filter(t=>t.closest("tab-interface")===this),this.tabPanels=Array.from(this.querySelectorAll('[role="tabpanel"]')).filter(t=>t.closest("tab-interface")===this),this.prevBtn=this.querySelector("[tablist-prev]"),this.nextBtn=this.querySelector("[tablist-next]"),this.prevClickHandler=this.createPrevClickHandler(),this.nextClickHandler=this.createNextClickHandler(),this.clickHandler=this.createClickHandler(),this.keyHandler=this.createKeyHandler()}createClickHandler(){return t=>{if(!t.target.closest('[role="tab"]'))return;let e=t.target.closest('[role="tab"]');if(t.preventDefault(),t.target.closest('[aria-selected="true"]'))return;let s=e.closest('[role="tablist"]').querySelector('[aria-selected="true"]');this.activateTab(s,e)}}createKeyHandler(){return t=>{const e=Array.from(this.tabs).indexOf(t.target);let s;s="ArrowLeft"===t.key?e-1<0?this.tabs.length-1:e-1:"ArrowRight"===t.key?e+1>this.tabs.length-1?0:e+1:"ArrowDown"===t.key?"down":null,null!==s&&(t.preventDefault(),"down"===s?this.tabPanels[e].focus():this.tabs[s]&&this.activateTab(t.target,this.tabs[s]))}}activateTab(t,e){e.setAttribute("tabindex","0"),e.setAttribute("aria-selected","true"),t.setAttribute("tabindex","-1"),t.removeAttribute("aria-selected");let s=Array.prototype.indexOf.call(this.tabs,e),r=Array.prototype.indexOf.call(this.tabs,t);this.tabPanels[r].hidden=!0,this.tabPanels[s].hidden=!1}setupObservers(){this.tabObserver=new IntersectionObserver(t=>{t.forEach(t=>{const e=t.target;if("tab"===e.getAttribute("role")){const s=t.isIntersecting;e.setAttribute("aria-hidden",s?"false":"true");e.querySelectorAll("a, button, [tabindex]").forEach(t=>{s?t.removeAttribute("tabindex"):t.setAttribute("tabindex","-1")}),this.setPrevNextBtnState()}})},{root:this.tabList,threshold:.9}),this.tabs.forEach(t=>this.tabObserver.observe(t))}removeObservers(){this.tabObserver&&(this.tabs.forEach(t=>this.tabObserver.unobserve(t)),this.tabObserver.disconnect(),this.tabObserver=null)}setPrevNextBtnState(){const t="false"===this.tabs[0].getAttribute("aria-hidden"),e="false"===this.tabs[this.tabs.length-1].getAttribute("aria-hidden");this.prevBtn&&(this.prevBtn.disabled=t),this.nextBtn&&(this.nextBtn.disabled=e)}smoothScrollTo(t){const e=t.offsetLeft;this.tabList.scrollTo({left:e,behavior:"smooth"})}createNextClickHandler(){return()=>{const t=this.tabs.findIndex(t=>"false"===t.getAttribute("aria-hidden"));t<this.tabs.length-1&&this.smoothScrollTo(this.tabs[t+1])}}createPrevClickHandler(){return()=>{const t=this.tabs.findIndex(t=>"false"===t.getAttribute("aria-hidden"));t>0&&this.smoothScrollTo(this.tabs[t-1])}}connectedCallback(){this.tabList&&(this.tabList.addEventListener("click",this.clickHandler),this.tabList.addEventListener("keydown",this.keyHandler),this.setupObservers(),this.prevBtn?.addEventListener("click",this.prevClickHandler),this.nextBtn?.addEventListener("click",this.nextClickHandler))}disconnectedCallback(){this.tabList&&(this.tabList.removeEventListener("click",this.clickHandler),this.tabList.removeEventListener("keydown",this.keyHandler),this.removeObservers(),this.prevBtn?.removeEventListener("click",this.prevClickHandler),this.nextBtn?.removeEventListener("click",this.nextClickHandler))}}customElements.define("tab-interface",TabInterface);