class FilterInterface extends HTMLElement{constructor(){super(),this.openFilterButtons=[...document.querySelectorAll("[filter-interface-open]")],this.openFilterCounters=[...document.querySelectorAll("[filter-count]")],this.openClickHandler=this.createOpenClickHandler(),this.closeClickHandler=this.createCloseClickHandler(),this.filterInputs=[],this.clearButton=null,this.filterNarrator=null,this.applyButton=null,this.previousFilters={},this.setupFilterInputs(),window.addEventListener("load",()=>{this.getActiveFilterCount(),this.handleButtonState()})}createOpenClickHandler(t){return t=>{t.preventDefault();let e=t.currentTarget;this.trigger=t.currentTarget,this.setAttribute("aria-hidden",!1),this.classList.add("ui-filter-modal--open");this.querySelectorAll("[filter-close]").forEach(t=>t.addEventListener("click",()=>this.closeClickHandler(this,e))),this.addEventListener("click",t=>{this===t.target&&this.closeClickHandler(this,e)}),this.makeOtherElementsInert(this),this.setAttribute("tabindex",0),window.disableScroll(),this.setupFilterInputs()}}createCloseClickHandler(t){return(t,e)=>{this.classList.contains("ui-filter-modal--open")&&(this.setAttribute("aria-hidden",!0),this.setAttribute("tabindex",-1),this.classList.remove("ui-filter-modal--open"),this.removeOtherElementsInert(),e.focus(),window.enableScroll())}}setupFilterInputs(){this.filterInputs=[...this.querySelectorAll("input, select, combobox-interface")],this.clearButton=this.querySelector("[filter-clear]"),this.applyButton=this.querySelector("[filter-apply]"),this.filterNarrator=this.querySelector("[filter-narrator]"),this.applyButton&&(this.applyButton.disabled=!0,this.applyButton.addEventListener("click",()=>{this.filterNarrator&&(this.filterNarrator.textContent="Filter is applied")})),this.filterInputs.forEach(t=>{"COMBOBOX-INTERFACE"===t.tagName?this.setupComboboxInterface(t):(t.addEventListener("input",()=>this.handleButtonState()),t.addEventListener("change",()=>this.handleButtonState()))}),this.clearButton&&(this.clearButtonText=this.clearButton.querySelector("span"),this.clearButton.addEventListener("click",()=>this.clearAllFilters())),this.updatePreviousFilters(),this.handleButtonState()}setupComboboxInterface(t){const e=t.querySelector(".m-combobox__input");t.querySelectorAll(".m-combobox__option").forEach(t=>{t.addEventListener("click",()=>{this.handleButtonState()})}),e.addEventListener("input",()=>this.handleButtonState())}updateTextWithNumber(t,e){const r=/\(\d+\)/,i=t.textContent;r.test(i)?t.textContent=0==e?i.replace(r,""):i.replace(r,`(${e})`):0!=e&&(t.textContent=`${i} (${e})`)}handleButtonState(){const t=this.getActiveFilterCount();if(this.applyButton){this.hasFiltersChanged();this.applyButton.hasAttribute("data-prevent-disable")?this.applyButton.disabled=!1:this.applyButton.disabled=!(t>0)}this.clearButton&&(this.clearButtonText.textContent=t>0?`Clear All (${t})`:"Clear All");let e=this.trigger?.querySelector("[filter-count]");e?this.updateTextWithNumber(e,t):this.openFilterCounters.forEach(e=>this.updateTextWithNumber(e,t))}getActiveFilterCount(){let t=0;return this.filterInputs.forEach(e=>{("checkbox"===e.type&&e.checked||"radio"===e.type&&e.checked||"text"===e.type&&""!==e.value.trim()||"SELECT"===e.tagName&&""!==e.value)&&t++}),t}clearAllFilters(){this.filterNarrator&&(this.filterNarrator.textContent="Filter is Reset"),this.filterInputs.forEach(t=>{"COMBOBOX-INTERFACE"===t.tagName?t.handleClear():"checkbox"===t.type||"radio"===t.type?t.checked=!1:"text"===t.type?t.value="":"SELECT"===t.tagName&&(t.selectedIndex=0)}),this.handleButtonState()}hasFiltersChanged(){const t=this.getCurrentFilterValues();return!this.areObjectsEqual(t,this.previousFilters)}getCurrentFilterValues(){const t={};return this.filterInputs.forEach(e=>{const r=e.getAttribute("data-filter")||e.getAttribute("name");if(r)if("COMBOBOX-INTERFACE"===e.tagName){const i=e.querySelector(".m-combobox__input").value.trim();i&&(t[r]=i)}else"checkbox"===e.type?(t[r]||(t[r]=[]),e.checked&&t[r].push(e.value)):"radio"===e.type?e.checked&&(t[r]=e.value):""!==e.value.trim()&&(t[r]=e.value.trim())}),t}areObjectsEqual(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(Array.isArray(t)!==Array.isArray(e))return!1;if(Array.isArray(t)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!areObjectsEqual(t[r],e[r]))return!1;return!0}}updatePreviousFilters(){this.previousFilters=this.getCurrentFilterValues()}makeOtherElementsInert(t){document.querySelectorAll("main").forEach(e=>{e!==t&&e.setAttribute("inert","true")})}removeOtherElementsInert(){document.querySelectorAll("[inert]").forEach(t=>t.removeAttribute("inert"))}connectedCallback(){this.openFilterButtons.forEach(t=>{t.getAttribute("filter-name")===this.id&&t.addEventListener("click",this.openClickHandler)})}disconnectedCallback(){this.openFilterButtons.forEach(t=>{t.getAttribute("filter-name")===this.id&&t.removeEventListener("click",this.openClickHandler)})}}customElements.define("filter-interface",FilterInterface);