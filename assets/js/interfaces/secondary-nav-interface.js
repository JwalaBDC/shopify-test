class SecondaryNavInterface extends HTMLElement{constructor(){super(),this.cards=[...this.querySelectorAll("[nav-slider-card]")],this.cardLists=this.querySelector("[nav-slider-card-list]"),this.navButton=this.querySelector(".ui-secondary-nav__action"),this.sections=[...document.querySelectorAll("main > section[id] , [modal-interface-content] > section[id]")],this.sliderNavs=[...this.querySelectorAll("[nav-slider-nav]")],this.prevBtns=[...this.querySelectorAll("[nav-slider-prev]")],this.nextBtns=[...this.querySelectorAll("[nav-slider-next]")],this.linkClickHandler=this.createLinkClickHandler(),this.prevClickHandler=this.createPrevClickHandler(),this.nextClickHandler=this.createNextClickHandler(),this.secondaryNav=document.querySelector("secondary-nav-interface"),this.header=document.querySelector("header"),this.headerHeight=this.header?this.header.offsetHeight:0,this.currentSectionInView=null,window.innerWidth<1024&&this.navButton&&this.nextBtns.forEach(e=>{e.style.right=this.navButton.getBoundingClientRect().width+10+"px"})}setupObservers(){this.sectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target.id,s=this.cards.find(e=>e.querySelector("[nav-link]").getAttribute("href")===`#${t}`);e.isIntersecting&&e.intersectionRatio>=.3?this.setLinkActive(s):this.removeLinkActive(s)})},{root:null,threshold:.3}),this.cardObserver=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target;if(t.hasAttribute("nav-slider-card")){const s=e.isIntersecting;t.setAttribute("aria-hidden",s?"false":"true");t.querySelectorAll("a, button, [tabindex]").forEach(e=>{s?e.removeAttribute("tabindex"):e.setAttribute("tabindex","-1")}),this.setSliderBtnState()}t.hasAttribute("nav-slider-card-list")&&(t.classList.toggle("is-visible",e.isIntersecting),this.setSliderNavVisibility())})},{root:document.documentElement,threshold:.75}),this.sections.forEach(e=>this.sectionObserver.observe(e)),this.cards.forEach(e=>this.cardObserver.observe(e)),this.cardObserver.observe(this.cardLists)}removeObservers(){this.sectionObserver&&(this.sections.forEach(e=>this.sectionObserver.unobserve(e)),this.sectionObserver.disconnect(),this.sectionObserver=null),this.cardObserver&&(this.cards.forEach(e=>this.cardObserver.unobserve(e)),this.cardObserver.unobserve(this.cardLists),this.cardObserver.disconnect(),this.cardObserver=null)}setLinkActive(e){if(!e)return;this.cards.forEach(e=>e.classList.remove("is-active"));const t=e.closest("[nav-slider-card]");t&&(t.classList.add("is-active"),this.smoothScrollTo(t),this.setSliderBtnState())}removeLinkActive(e){e&&e.closest("[nav-slider-card]").classList.remove("is-active")}setSliderBtnState(){const e=this.cardLists.scrollLeft,t=this.cardLists.offsetWidth,s=this.cardLists.scrollWidth,i=e+t>=s-2;this.prevBtns.forEach(t=>t.disabled=e<=1),this.nextBtns.forEach(e=>e.disabled=i)}setSliderNavVisibility(){const e=this.cards.every(e=>"false"===e.getAttribute("aria-hidden"));this.sliderNavs.forEach(t=>t.hidden=e)}smoothScrollTo(e){const t=this.cardLists,s=(this.cards.indexOf(e),e.offsetLeft);t.scrollTo({left:s,behavior:"smooth"})}createNextClickHandler(){return()=>{const e=this.cards.findIndex(e=>"false"===e.getAttribute("aria-hidden"));console.log("next",this.cards[e+1]),e<this.cards.length-1&&this.smoothScrollTo(this.cards[e+1])}}createPrevClickHandler(){return()=>{const e=this.cards.findIndex(e=>"false"===e.getAttribute("aria-hidden"));console.log("prev",this.cards[e-1]),e>0&&this.smoothScrollTo(this.cards[e-1])}}onScroll(){const e=window.scrollY;this.handleSticky(),this.cards.forEach(t=>{t.classList.remove("is-active");const s=t.querySelector("[nav-link]");if(!s.href)return;const i=new URL(s.href).hash,r=document.querySelector(i);if(r){const s=r.offsetTop-this.header.offsetHeight,i=s+r.offsetHeight;e>s&&e<i&&(t.classList.add("is-active"),this.cardLists.scrollLeft=t.offsetLeft-12)}}),this.setSliderBtnState()}handleSticky(){const e=window.scrollY;this.secondaryOffsetTop=this.getBoundingClientRect().top,void 0===this.lastScrollPosition&&(this.lastScrollPosition=e);const t=e>this.lastScrollPosition,s=e<this.lastScrollPosition;if(t){if((e>=this.secondaryOffsetTop+window.scrollY||this.secondaryOffsetTop<=0)&&this.header.classList.add("ui-header--hide"),this.headerHeight>this.secondaryOffsetTop){const e=this.headerHeight-this.secondaryOffsetTop;this.header.style.transform=`translate(0px, -${e}px)`}else this.header.removeAttribute("style");this.secondaryNav.style.top="-1px"}else if(s){if(this.header.classList.remove("ui-header--hide"),this.headerHeight<this.secondaryOffsetTop){this.headerHeight,this.secondaryOffsetTop;this.header.style.transform="translate(0px, 0px)"}else this.header.removeAttribute("style");this.secondaryNav.style.top=this.headerHeight-1+"px",this.header.style.transition="transform 0.15s ease-in-out",this.secondaryNav.style.transition="top 0.15s ease-in-out"}this.lastScrollPosition=e}debounce(e,t,s){let i;return function r(...n){const o=this,c=s&&!i;clearTimeout(i),i=setTimeout(()=>{i=null,s||e.apply(o,n)},t),c&&e.apply(o,n)}}createLinkClickHandler(){return e=>{e.preventDefault();const t=e.target.getAttribute("href"),s=document.querySelector(`${t}`);if(!s)return;var i=s.getBoundingClientRect().top;let r=document.querySelector(".ui-flyout-menu__level-nav.is-visible")?this.header.offsetHeight-60:this.header.offsetHeight;var n=i+window.pageYOffset-r;window.scrollTo({top:n,behavior:"smooth"})}}connectedCallback(){this.setupObservers(),window.addEventListener("scroll",this.onScroll.bind(this)),this.cardLists.addEventListener("scroll",this.setSliderBtnState.bind(this)),this.cards.forEach(e=>{const t=e.querySelector("[nav-link]");t&&t.addEventListener("click",this.linkClickHandler)}),this.prevBtns.forEach(e=>{e.addEventListener("click",this.prevClickHandler)}),this.nextBtns.forEach(e=>{e.addEventListener("click",this.nextClickHandler)})}disconnectedCallback(){this.removeObservers(),window.removeEventListener("scroll",this.onScroll.bind(this)),this.cardLists.removeEventListener("scroll",this.setSliderBtnState.bind(this)),this.cards.forEach(e=>{const t=e.querySelector("[nav-link]");t&&t.removeEventListener("click",this.linkClickHandler)}),this.prevBtns.forEach(e=>{e.removeEventListener("click",this.prevClickHandler)}),this.nextBtns.forEach(e=>{e.removeEventListener("click",this.nextClickHandler)})}}customElements.define("secondary-nav-interface",SecondaryNavInterface);