class InPageMenuDropdownHandler{constructor(e){this.dropdown=e,this.header=document.querySelector("header"),this.inPageMenuLinks=e.inPageMenuLinks,this.dropdownBtn=e.dropdownBtn,this.isDesktop=window.innerWidth>1023,this.sectionTops=[],this.resizeHandler=this.createResizeHandler(),this.scrollHandler=this.createScrollHandler(),this.addEventListeners()}addResizeObserver(){this.resizeObserver=new ResizeObserver(this.handleBodyHeightChange.bind(this)),this.debouncedResizeHandler=this.debounce(this.resizeHandler.bind(this),200),this.resizeObserver.observe(document.body)}debounce(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}handleBodyHeightChange(e){for(const t of e)t.target===document.body&&this.debouncedResizeHandler(window.innerWidth,window.innerHeight)}removeResizeObserver(){this.resizeObserver.unobserve(document.body),this.resizeObserver.disconnect(),this.resizeObserver=null}createScrollHandler(){return e=>{let t="";this.inPageMenuLinks.forEach((n,i)=>{if(n.classList.remove("is-active"),!n.href)return;const o=new URL(n.href).hash,s=document.querySelector(o);if(s){if(n.parentNode.classList.remove("menu-item-hidden"),s){const o=this.sectionTops[i];e>o&&(t=n)}}else n.parentNode.classList.add("menu-item-hidden")}),t&&(this.dropdown.dropdownBtnText.textContent=t.textContent,t.classList.add("is-active"))}}createResizeHandler(){return(e,t)=>{const n=this.header.offsetHeight,i=this.dropdownBtn.offsetHeight;this.sectionTops=[],this.inPageMenuLinks.forEach((e,t)=>{if(!e.href)return;const o=new URL(e.href).hash,s=document.querySelector(o);s&&(this.sectionTops[t]=s.offsetTop-n-i)})}}onInPageMenuLinkClick(e){e.preventDefault();const t=e.currentTarget,n=new URL(t.href).hash,i=document.querySelector(n);this.dropdown.closeDropdown(),setTimeout(()=>{if(i){const e=-80,t=i.getBoundingClientRect().top+window.scrollY+e;window.scrollTo({top:t,behavior:"smooth"})}},50)}addEventListeners(){this.addResizeObserver(),this.resizeHandler(window.innerWidth,window.innerHeight),window.resizeManager.subscribe(this.resizeHandler),window.scrollManager.subscribe(this.scrollHandler),this.inPageMenuLinks.forEach(e=>{e.addEventListener("click",this.onInPageMenuLinkClick.bind(this))})}removeEventListeners(){this.removeResizeObserver(),window.resizeManager.unsubscribe(this.resizeHandler),window.scrollManager.unsubscribe(this.scrollHandler),this.inPageMenuLinks.forEach(e=>{e.removeEventListener("click",this.onInPageMenuLinkClick.bind(this))})}}class DropdownInterface extends HTMLElement{constructor(){super(),this.isDesktop=window.innerWidth>1023,this.mobileScrollLockOnOpen=this.hasAttribute("mobile-scroll-lock-on-open"),this.desktopScrollLockOnOpen=this.hasAttribute("desktop-scroll-lock-on-open"),this.isDisabled=this.hasAttribute("disabled"),this.isMultiSelect=this.hasAttribute("[multiselect]"),this.inPageMenuLinks=Array.from(this.querySelectorAll("[dropdown-inpage-menu-link]")),this.dropdownBtn=this.querySelector("[dropdown-btn]"),this.dropdownBtnText=this.dropdownBtn.querySelector("[dropdown-btn-text]"),this.dropdownOptionsList=this.querySelector("[dropdown-options-list]"),this.dropdownPopup=this.querySelector("[dropdown-popup]"),this.defaultValue=this.getAttribute("dropdown-default-value")??"",this.resetBtn=this.querySelector("[dropdown-reset-btn]"),this.resetFilterBtn=this.querySelector("[x-pagination-reset-filters-btn"),this.checkboxInputs=Array.from(this.dropdownPopup.querySelectorAll("[type='checkbox']")),this.dropdownListItems=Array.from(this.dropdownPopup.querySelectorAll("[dropdown-options-list-item]")),this.closeBtn=this.dropdownPopup.querySelector("[dropdown-close-btn]"),this.applyBtn=this.dropdownPopup.querySelector("[dropdown-apply-btn]"),this.scrollbarThumb=this.dropdownPopup.querySelector("[dropdown-scrollbar-thumb]"),this.dropdownOptions=Array.from(this.dropdownPopup.querySelectorAll("[role='option']")),this.dropdownPopup.setAttribute("tabindex","-1"),this.resetBtn?.setAttribute("tabindex","-1"),this.dropdownPopup.setAttribute("aria-hidden","true"),this.isExpanded=!1,this.activeIndex=-1,this.selectOptions=[],this.dropdownOptions.length>0?this.selectOptions=this.dropdownOptions:this.checkboxInputs.length>0?this.selectOptions=this.checkboxInputs:this.inPageMenuLinks.length>0&&(this.selectOptions=this.inPageMenuLinks),this.resetBtn&&this.selectOptions.push(this.resetBtn),this.checkboxInputs.forEach(e=>e.setAttribute("tabindex","-1")),this.setPosition(),this.makeDropDownInert(),this.inPageMenuLinks.length>0&&(this.inPageMenuDropdownHandler=new InPageMenuDropdownHandler(this));const e=document.querySelector(".ui-secondary-menu-dropdown__btn");e&&e.addEventListener("click",function(){document.documentElement.classList.toggle("open-secondary-menu")})}onFocusableElementKeydown(e){const{key:t}=e;"Tab"===t&&(e.shiftKey&&document.activeElement===this.firstElement?(e.preventDefault(),this.lastElement.focus()):e.shiftKey||document.activeElement!==this.lastElement||(e.preventDefault(),this.firstElement.focus()))}trapFocusInDropdown(){const e=this.dropdownPopup.querySelectorAll('a, button, input, textarea, select, [role], [tabindex]:not([tabindex="-1"])');this.firstElement=e[0],this.lastElement=e[e.length-1],window.innerWidth<1024&&this.dropdownPopup.addEventListener("keydown",this.onFocusableElementKeydown.bind(this))}releaseFocusInDropdown(){this.dropdownPopup.removeEventListener("keydown",this.onFocusableElementKeydown.bind(this))}makeDropDownInert(){this.dropdownPopup.querySelectorAll('a, button, input, textarea, select, [role], [tabindex]:not([tabindex="-1"])').forEach(e=>e.setAttribute("inert","true"))}removeDropdownInertState(){const e=this.dropdownPopup.querySelectorAll("[inert]");e?.forEach(e=>e.removeAttribute("inert")),this.closeBtn?.removeAttribute("disabled")}toggleDropdown(e){e.stopPropagation(),this.isDisabled||(this.isExpanded?this.closeDropdown():(DropdownInterface.openDropdown&&DropdownInterface.openDropdown!==this&&DropdownInterface.openDropdown.closeDropdown(),DropdownInterface.openDropdown=this,this.isExpanded=!0,this.dropdownBtn.setAttribute("aria-expanded","true"),this.dropdownPopup.setAttribute("aria-hidden","false"),this.disablePageScroll(),this.animateDropdownOpen(),this.removeDropdownInertState(),this.trapFocusInDropdown()))}closeDropdown(){this.isExpanded&&(this.isExpanded=!1,this.dropdownBtn.setAttribute("aria-expanded","false"),this.dropdownPopup.setAttribute("aria-hidden","true"),DropdownInterface.openDropdown===this&&(DropdownInterface.openDropdown=null),this.animateDropdownClose(),this.restorePageScroll(),this.releaseFocusInDropdown(),this.makeDropDownInert(),this.dropdownBtn.focus())}disablePageScroll(){this.mobileScrollLockOnOpen&&window.innerWidth<1024&&(window.disableScroll(),document.documentElement.classList.add("show-modal-overlay")),this.desktopScrollLockOnOpen&&window.innerWidth>=1024&&(window.disableScroll(),document.documentElement.classList.add("show-modal-overlay"))}restorePageScroll(){this.mobileScrollLockOnOpen&&window.innerWidth<1024&&(window.enableScroll(),document.documentElement.classList.remove("show-modal-overlay")),this.desktopScrollLockOnOpen&&window.innerWidth>=1024&&(window.enableScroll(),document.documentElement.classList.remove("show-modal-overlay"))}getDropdownPopupHeight(){const e=this.dropdownPopup.scrollHeight;if(this.isDesktop)return e;if(this.hasAttribute("data-filter"))return window.innerHeight;{const t=window.innerHeight-this.dropdownPopup.getBoundingClientRect().top;return e>t?t:e}}animateDropdownOpen(){this.setPosition(),this.dropdownPopup.setAttribute("aria-hidden","false"),gsap.fromTo(this.dropdownPopup,{height:0},{height:this.getDropdownPopupHeight(),duration:this.isDesktop?.2:.3,ease:"emphasized-decelerate",onComplete:()=>{this.dropdownPopup.setAttribute("tabindex","0"),this.resetBtn?.setAttribute("tabindex","0"),setTimeout(()=>{this.scrollbarThumb?.verticalScrollbarInstance.setDimensions(),this.scrollbarThumb&&(this.scrollbarThumb.verticalScrollbarInstance.extraSpace=5)},100),this.checkboxInputs.length>0&&(this.checkboxInputs.forEach(e=>e.setAttribute("tabindex","0")),this.checkboxInputs[0].focus())}}),gsap.fromTo(this.dropdownListItems,{opacity:0,y:this.isDesktop?-4:-8},{opacity:1,y:0,duration:this.isDesktop?.3:.4,stagger:this.isDesktop?.03:.02,ease:"standard-decelerate"})}animateDropdownClose(){gsap.to(this.dropdownPopup,{height:0,duration:this.isDesktop?.1:0,ease:"emphasized",onComplete:()=>{this.dropdownPopup.setAttribute("aria-hidden",!this.isExpanded),this.dropdownPopup.setAttribute("tabindex","-1"),this.resetBtn?.setAttribute("tabindex","-1")}}),this.checkboxInputs.forEach(e=>e.setAttribute("tabindex","-1"))}toggleCheckbox(e){let t=this.dropdownPopup.querySelectorAll("[type='checkbox']:checked").length;t<=0?(this.dropdownBtnText.removeAttribute("data-checked-count"),this.dropdownBtnText.innerHTML=this.dropdownBtnText.textContent.split(" (")[0]):(this.dropdownBtnText.setAttribute("data-checked-count",t>0?`(${t})`:""),this.dropdownBtnText.innerHTML=this.dropdownBtnText.textContent.split(" (")[0]+` (${t})`),this.resetBtn?.parentElement?.setAttribute("aria-hidden",0==t)}onDropdownOptionClick(e){if(e.currentTarget.hasAttribute("dropdown-reset-btn"))return;this.dropdownOptions.forEach(e=>e.setAttribute("aria-selected",!1));const t=e.currentTarget;let n="true"===t.getAttribute("aria-selected");this.dropdownBtnText.textContent=t.getAttribute("value"),t.setAttribute("aria-selected",!n),this.resetBtn?.parentElement?.setAttribute("aria-hidden",!1),this.isMultiSelect||this.closeDropdown()}scrollToLastElement(){const e=this.dropdownOptions[this.dropdownOptions.length-1];e&&(this.dropdownOptionsList.scrollTop=e.offsetTop)}onResetBtnClick(e){e.preventDefault(),this.dropdownOptionsList&&(this.dropdownOptionsList.scrollTop=0),this.resetDropdown()}resetDropdown(){if(this.checkboxInputs.length>0){this.dropdownPopup.querySelectorAll("[type='checkbox']:checked").forEach(e=>e.checked=!1),this.dropdownBtnText.removeAttribute("data-checked-count"),this.dropdownBtnText.innerHTML=this.dropdownBtnText.textContent.split(" (")[0]}this.dropdownOptions.forEach(e=>{"true"===e.getAttribute("aria-selected")&&e.setAttribute("aria-selected",!1),this.dropdownBtnText.textContent=this.defaultValue}),this.resetBtn?.parentElement?.setAttribute("aria-hidden",!0),this.closeDropdown()}onDocumentClick(e){this.isExpanded&&!this.contains(e.target)&&this.closeDropdown()}setPosition(){if(window.innerWidth<1024)return;const e=this.dropdownPopup.getBoundingClientRect();this.dropdownBtnOffset=this.dropdownBtn.getBoundingClientRect().top+32+8;const t=e.width,n=e.right-t>window.innerWidth/2;this.dropdownPopup.classList[n?"add":"remove"]("is-right-aligned")}onDocumentKeydown(e){const{key:t}=e;if(!this.isExpanded&&["Enter"," "].includes(t)&&document.activeElement==this.dropdownBtn)e.preventDefault(),this.toggleDropdown(e);else switch(t){case"ArrowDown":e.preventDefault(),this.navigateOptions(1);break;case"ArrowUp":e.preventDefault(),this.navigateOptions(-1);break;case"Enter":e.preventDefault(),this.selectOption();break;case"Escape":e.preventDefault(),this.closeDropdown();break;default:this.handleAlphanumericKeyPress(t)}}handleAlphanumericKeyPress(e){if(this.selectOptions.length>0&&this.isExpanded){if(!/^[a-zA-Z0-9]$/.test(e))return;this.keySearch=e.toLowerCase();const t=this.selectOptions.find((e,t)=>t>this.activeIndex&&e.getAttribute("value").toLowerCase().startsWith(this.keySearch));t&&(this.activeIndex=this.selectOptions.indexOf(t),this.updateCustomSelectHovered(this.activeIndex,"start"))}}navigateOptions(e){if(0===this.selectOptions.length||!this.isExpanded)return;let t=this.activeIndex;do{this.activeIndex=(this.activeIndex+e+this.selectOptions.length)%this.selectOptions.length}while("true"===this.selectOptions[this.activeIndex].getAttribute("aria-hidden")&&this.activeIndex!==t);"true"===this.selectOptions[this.activeIndex].getAttribute("aria-hidden")&&(this.activeIndex=-1),this.selectOptions.forEach((e,t)=>{e&&"true"!==e.getAttribute("aria-hidden")&&e.classList[t===this.activeIndex?"add":"remove"]("has-focus")}),-1!==this.activeIndex&&this.selectOptions[this.activeIndex].scrollIntoView({behavior:"smooth",block:"nearest"})}selectOption(){-1!==this.activeIndex&&this.isExpanded&&this.selectOptions[this.activeIndex]&&(this.selectOptions[this.activeIndex].focus(),this.selectOptions[this.activeIndex].click())}updateCustomSelectHovered(e,t){if(0===this.selectOptions.length||!this.isExpanded)return;this.activeIndex=e,this.selectOptions.forEach(e=>{e.setAttribute("aria-selected",!1)});const n=this.selectOptions[e];n&&(n.setAttribute("aria-selected",!0),n.scrollIntoView({block:t}))}onCheckboxKeydown(e){const t=e.target;" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),t.checked=!t.checked,this.toggleCheckbox(e),t.focus())}connectedCallback(){this.inPageMenuDropdownHandler&&this.inPageMenuDropdownHandler.resizeHandler(window.innerWidth,window.innerHeight),window.addEventListener("load",()=>{this.inPageMenuDropdownHandler&&this.inPageMenuDropdownHandler.resizeHandler(window.innerWidth,window.innerHeight)}),this.manageEventListeners("addEventListener")}disconnectedCallback(){this.inPageMenuDropdownHandler&&this.inPageMenuDropdownHandler.removeEventListeners(),this.manageEventListeners("removeEventListener")}rebindOptionClickEven(){this.dropdownOptions=Array.from(this.dropdownPopup.querySelectorAll("[role='option']")),this.dropdownOptions.forEach(e=>{e.addEventListener("click",this.onDropdownOptionClick.bind(this))})}manageEventListeners(e){this.dropdownBtn[e]("click",this.toggleDropdown.bind(this)),this.resetBtn?.[e]("click",this.onResetBtnClick.bind(this)),this.resetFilterBtn?.[e]("click",this.onResetBtnClick.bind(this)),this.closeBtn?.[e]("click",this.closeDropdown.bind(this)),this.applyBtn?.[e]("click",this.closeDropdown.bind(this)),document[e]("click",this.onDocumentClick.bind(this)),document[e]("keydown",this.onDocumentKeydown.bind(this)),window[e]("resize",this.setPosition.bind(this)),window.innerWidth>1024&&window[e]("scroll",this.closeDropdown.bind(this)),this.checkboxInputs.forEach(t=>{t[e]("click",this.toggleCheckbox.bind(this)),t[e]("keydown",this.onCheckboxKeydown.bind(this))}),this.dropdownOptions.forEach(t=>{t[e]("click",this.onDropdownOptionClick.bind(this))});const t=document.querySelectorAll(".ui-flyout-menu__level1-nav-item");t&&t.forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation(),this.closeDropdown()})}),setTimeout(()=>{let e=this.dropdownPopup.querySelectorAll("[type='checkbox']"),t=0;e.forEach(e=>{e.checked&&t++}),this.dropdownBtnText&&(t>0?(this.dropdownBtnText.setAttribute("data-checked-count",`(${t})`),this.dropdownBtnText.innerHTML=this.dropdownBtnText.textContent.split(" (")[0]+` (${t})`):(this.dropdownBtnText.removeAttribute("data-checked-count"),this.dropdownBtnText.innerHTML=this.dropdownBtnText.textContent.split(" (")[0]))},100)}}customElements.define("dropdown-interface",DropdownInterface);