export default class Stagger{constructor({element:t}){this.container=t,this.staggerElements=[...this.container.querySelectorAll("[data-stagger-motion-index]")].filter(t=>t.closest("[data-stagger-motion-observer]")===this.container),this.persist=!0,this.container.hasAttribute("data-stagger-motion-persist")&&"false"===this.container.getAttribute("data-stagger-motion-persist")&&(this.persist=!1),this.isAnimatedIn=!1,this.init(),this.animateOut(),this.addEventListeners()}reQueryDOM(){this.staggerElements=[...this.container.querySelectorAll("[data-stagger-motion-index]")].filter(t=>t.closest("[data-stagger-motion-observer]")===this.container),this.isAnimatedIn=!1,this.animateOut()}init(){this.setTataChemAnimationConfig(),this.isInvokedImmediate="true"===this.container.getAttribute("data-motion-invoke-immediate"),this.isInvokedImmediate&&(this.isAnimatedIn=!1,this.animateOut(),this.animateIn())}setTataChemAnimationConfig(){const t=navigator.userAgent.toLowerCase();let e=t.includes("safari")&&!t.includes("chrome")||!!window.ApplePaySetupFeature||!!window.safari?500:450;this.easingToken="custom-cubic-easing",this.stagger="0.06",this.animationConfig={xxs:{y:20,duration:e,ease:this.easingToken},xs:{y:60,duration:e,ease:this.easingToken},sm:{y:60,duration:e,ease:this.easingToken},md:{y:80,duration:e,ease:this.easingToken},lg:{y:100,duration:e,ease:this.easingToken}},window.innerWidth<768&&(this.stagger="0.05",this.easingToken="power2.out",this.animationConfig={xxs:{y:20,duration:e,ease:this.easingToken},xs:{y:40,duration:e,ease:this.easingToken},sm:{y:40,duration:e,ease:this.easingToken},md:{y:40,duration:e,ease:this.easingToken},lg:{y:40,duration:e,ease:this.easingToken}})}setGodrejAnimationConfig(){this.easingToken="standard-decelerate",this.stagger="0.05",this.animationConfig={xxs:{y:0,duration:350,ease:this.easingToken},xs:{y:20,duration:350,ease:this.easingToken},sm:{y:40,duration:350,ease:this.easingToken},md:{y:80,duration:350,ease:this.easingToken},lg:{y:120,duration:350,ease:this.easingToken}},window.innerWidth<768&&(this.animationConfig={xxs:{y:0,duration:350,ease:this.easingToken},xs:{y:20,duration:350,ease:this.easingToken},sm:{y:40,duration:350,ease:this.easingToken},md:{y:60,duration:350,ease:this.easingToken},lg:{y:90,duration:350,ease:this.easingToken}})}animateIn(){if(!this.isAnimatedIn){this.isAnimatedIn=!0;for(const t of this.staggerElements){if(this.persist&&this.container.classList.contains("has-staggered-in")&&!t.hasAttribute("data-stagger-motion-retrigger-target"))continue;const e=t.dataset.staggerMotionType??"sm",i=parseInt(t.dataset.staggerMotionIndex)-1;let{duration:s,ease:a}=this.animationConfig[e];const n=this.stagger*i;t.dataset.staggerMotionDelay=n,gsap.to(t,{y:0,opacity:1,ease:a,delay:n,duration:s/1e3,onComplete:()=>{t.style.transform=""}})}this.container.classList.add("has-staggered-in")}}animateElementsIn(t){for(const e of t){this.staggerElements.includes(e)||this.staggerElements.push(e);const t=e.dataset.staggerMotionType??"sm",i=parseInt(e.dataset.staggerMotionIndex)-1;let{y:s}=this.animationConfig[t],{duration:a,ease:n}=this.animationConfig[t];const o=.05*i;e.dataset.staggerMotionDelay=o,gsap.fromTo(e,{y:s,opacity:0},{y:0,opacity:1,ease:n,delay:o,duration:a/1e3,onComplete:()=>{e.style.transform=""}})}}animateOut(){if(this.isAnimatedIn&&this.persist)this.container.dispatchEvent(new CustomEvent("unobserve"));else{this.isAnimatedIn=!1;for(const t of this.staggerElements){if(this.persist&&this.container.classList.contains("has-staggered-in")&&!t.hasAttribute("data-stagger-motion-retrigger-target"))continue;const e=t.dataset.staggerMotionType??"sm";let{y:i}=this.animationConfig[e];t.dataset.fromY&&(i=parseFloat(t.dataset.fromY)),gsap.killTweensOf([t]),gsap.set(t,{y:i,opacity:0})}}}retriggerAnimation(){this.isAnimatedIn=!1,this.animateOut(),this.animateIn()}addEventListeners(){const t=[...this.container.querySelectorAll("[data-stagger-motion-retrigger-btn]")].filter(t=>t.closest("[data-stagger-motion-observer]")===this.container);for(const e of t)e.addEventListener("click",this.retriggerAnimation.bind(this))}}